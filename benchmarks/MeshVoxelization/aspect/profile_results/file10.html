<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" /><link rel="stylesheet" href="file:////Applications/MATLAB_R2013a.app/toolbox/matlab/codetools/matlab-report-styles.css" type="text/css" /><title>Function details for VOXELISE</title><link rel="stylesheet" href="file:////Applications/MATLAB_R2013a.app/toolbox/matlab/codetools/matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">VOXELISE (1 call, 51.423 sec)</span><br/><i>Generated 29-Jan-2014 11:05:01 using cpu time.</i><br/>function in file /Users/david/work/courses/621/a1/Mesh_voxelisation/aspect/VOXELISE.m<br/>Copy to new window for comparing multiple runs<div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file1.html">Benchmark</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">1</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line262">262</a></td><td class="td-linebottomrt"><pre>gridOUTPUT(:, :, :, countdirec...</pre></td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">32.845 s</td><td class="td-linebottomrt" class="td-linebottomrt">63.9%</td><td class="td-linebottomrt"><img src="file:////Applications/MATLAB_R2013a.app/toolbox/matlab/codetools/private/one-pixel.gif" width=64 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line270">270</a></td><td class="td-linebottomrt"><pre>gridOUTPUT(:, :, :, countdirec...</pre></td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">9.532 s</td><td class="td-linebottomrt" class="td-linebottomrt">18.5%</td><td class="td-linebottomrt"><img src="file:////Applications/MATLAB_R2013a.app/toolbox/matlab/codetools/private/one-pixel.gif" width=19 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line266">266</a></td><td class="td-linebottomrt"><pre>gridOUTPUT(:, :, :, countdirec...</pre></td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">9.014 s</td><td class="td-linebottomrt" class="td-linebottomrt">17.5%</td><td class="td-linebottomrt"><img src="file:////Applications/MATLAB_R2013a.app/toolbox/matlab/codetools/private/one-pixel.gif" width=18 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line254">254</a></td><td class="td-linebottomrt"><pre>voxcountX = numel(gridCOx);</pre></td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">0.032 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.1%</td><td class="td-linebottomrt"><img src="file:////Applications/MATLAB_R2013a.app/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line327">327</a></td><td class="td-linebottomrt"><pre>end</pre></td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt" class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:////Applications/MATLAB_R2013a.app/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">0.000 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////Applications/MATLAB_R2013a.app/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">51.423 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="file5.html">VOXELISE>VOXELISEinternal</a></td><td class="td-linebottomrt">subfunction</td><td class="td-linebottomrt">3</td><td class="td-linebottomrt">51.391 s</td><td class="td-linebottomrt">99.9%</td><td class="td-linebottomrt"><img src="file:////Applications/MATLAB_R2013a.app/toolbox/matlab/codetools/private/one-pixel.gif" width=100 height=10></td></tr><tr><td class="td-linebottomrt">Self time (built-ins, overhead, etc.)</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">0.032 s</td><td class="td-linebottomrt">0.1%</td><td class="td-linebottomrt"><img src="file:////Applications/MATLAB_R2013a.app/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">51.423 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><strong>Code Analyzer results</strong><br/>No Code Analyzer messages.<div class="grayline"/><strong>Coverage results</strong><br/>Show coverage for parent directory <br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">327</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">152</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">175</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">83</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">92</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">47.43 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0">   1</span> <span style="color: #A0A0A0; background: #FFFFFF;">function [gridOUTPUT, varargout] = VOXELISE(gridX, gridY, gridZ, varargin)</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">   2</span> <span style="color: #000000; background: #FFFFFF;">  global AM_GLOBAL; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">   3</span> <span style="color: #000000; background: #FFFFFF;">  if isempty(AM_GLOBAL) </span><br/>               <span style="color: #A0A0A0">   4</span> <span style="color: #A0A0A0; background: #FFFFFF;">    AM_GLOBAL.arrayGrowingAspect = arrayGrowingAspect;</span><br/>               <span style="color: #A0A0A0">   5</span> <span style="color: #A0A0A0; background: #FFFFFF;">    AM_EntryPoint_1 = 1;</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">   6</span> <span style="color: #228B22; background: #FFFFFF;">  else  </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">   7</span> <span style="color: #000000; background: #FFFFFF;">    AM_EntryPoint_1 = 0; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">   8</span> <span style="color: #000000; background: #FFFFFF;">  end </span><br/>               <span style="color: #A0A0A0">   9</span> <span style="color: #228B22; background: #FFFFFF;">% VOXELISE  Voxelise a 3D triangular-polygon mesh.</span><br/>               <span style="color: #A0A0A0">  10</span> <span style="color: #228B22; background: #FFFFFF;">%==========================================================================</span><br/>               <span style="color: #A0A0A0">  11</span> <span style="color: #228B22; background: #FFFFFF;">% AUTHOR        Adam H. Aitkenhead</span><br/>               <span style="color: #A0A0A0">  12</span> <span style="color: #228B22; background: #FFFFFF;">% CONTACT       adam.aitkenhead@christie.nhs.uk</span><br/>               <span style="color: #A0A0A0">  13</span> <span style="color: #228B22; background: #FFFFFF;">% INSTITUTION   The Christie NHS Foundation Trust</span><br/>               <span style="color: #A0A0A0">  14</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  15</span> <span style="color: #228B22; background: #FFFFFF;">% USAGE        [gridOUTPUT,gridCOx,gridCOy,gridCOz] = VOXELISE(gridX,gridY,gridZ,STLin,raydirection)</span><br/>               <span style="color: #A0A0A0">  16</span> <span style="color: #228B22; background: #FFFFFF;">%        or... [gridOUTPUT,gridCOx,gridCOy,gridCOz] = VOXELISE(gridX,gridY,gridZ,meshFV,raydirection)</span><br/>               <span style="color: #A0A0A0">  17</span> <span style="color: #228B22; background: #FFFFFF;">%        or... [gridOUTPUT,gridCOx,gridCOy,gridCOz] = VOXELISE(gridX,gridY,gridZ,meshX,meshY,meshZ,raydirection)</span><br/>               <span style="color: #A0A0A0">  18</span> <span style="color: #228B22; background: #FFFFFF;">%        or... [gridOUTPUT,gridCOx,gridCOy,gridCOz] = VOXELISE(gridX,gridY,gridZ,meshXYZ,raydirection)</span><br/>               <span style="color: #A0A0A0">  19</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  20</span> <span style="color: #228B22; background: #FFFFFF;">% INPUTS</span><br/>               <span style="color: #A0A0A0">  21</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  22</span> <span style="color: #228B22; background: #FFFFFF;">%     gridX   - Mandatory - 1xP array     - List of the grid X coordinates. </span><br/>               <span style="color: #A0A0A0">  23</span> <span style="color: #228B22; background: #FFFFFF;">%                           OR an integer - Number of voxels in the grid in the X direction.</span><br/>               <span style="color: #A0A0A0">  24</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  25</span> <span style="color: #228B22; background: #FFFFFF;">%     gridY   - Mandatory - 1xQ array     - List of the grid Y coordinates.</span><br/>               <span style="color: #A0A0A0">  26</span> <span style="color: #228B22; background: #FFFFFF;">%                           OR an integer - Number of voxels in the grid in the Y direction.</span><br/>               <span style="color: #A0A0A0">  27</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  28</span> <span style="color: #228B22; background: #FFFFFF;">%     gridZ   - Mandatory - 1xR array     - List of the grid Z coordinates.</span><br/>               <span style="color: #A0A0A0">  29</span> <span style="color: #228B22; background: #FFFFFF;">%                           OR an integer - Number of voxels in the grid in the Z direction.</span><br/>               <span style="color: #A0A0A0">  30</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  31</span> <span style="color: #228B22; background: #FFFFFF;">%     STLin   - Optional  - string        - Filename of the STL file.</span><br/>               <span style="color: #A0A0A0">  32</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  33</span> <span style="color: #228B22; background: #FFFFFF;">%     meshFV  - Optional  - structure     - Structure containing the faces and vertices</span><br/>               <span style="color: #A0A0A0">  34</span> <span style="color: #228B22; background: #FFFFFF;">%                                           of the mesh, in the same format as that produced</span><br/>               <span style="color: #A0A0A0">  35</span> <span style="color: #228B22; background: #FFFFFF;">%                                           by the isosurface command.</span><br/>               <span style="color: #A0A0A0">  36</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  37</span> <span style="color: #228B22; background: #FFFFFF;">%     meshX   - Optional  - 3xN array     - List of the mesh X coordinates for the 3 vertices of each of the N triangular patches</span><br/>               <span style="color: #A0A0A0">  38</span> <span style="color: #228B22; background: #FFFFFF;">%     meshY   - Optional  - 3xN array     - List of the mesh Y coordinates for the 3 vertices of each of the N triangular patches</span><br/>               <span style="color: #A0A0A0">  39</span> <span style="color: #228B22; background: #FFFFFF;">%     meshZ   - Optional  - 3xN array     - List of the mesh Z coordinates for the 3 vertices of each of the N triangular patches</span><br/>               <span style="color: #A0A0A0">  40</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  41</span> <span style="color: #228B22; background: #FFFFFF;">%     meshXYZ - Optional  - Nx3x3 array   - The vertex coordinates for each facet, with:</span><br/>               <span style="color: #A0A0A0">  42</span> <span style="color: #228B22; background: #FFFFFF;">%                                           1 row for each facet</span><br/>               <span style="color: #A0A0A0">  43</span> <span style="color: #228B22; background: #FFFFFF;">%                                           3 columns for the x,y,z coordinates</span><br/>               <span style="color: #A0A0A0">  44</span> <span style="color: #228B22; background: #FFFFFF;">%                                           3 pages for the three vertices</span><br/>               <span style="color: #A0A0A0">  45</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  46</span> <span style="color: #228B22; background: #FFFFFF;">%     raydirection - Optional - String    - Defines the directions in which ray-tracing</span><br/>               <span style="color: #A0A0A0">  47</span> <span style="color: #228B22; background: #FFFFFF;">%                                           is performed.  The default is 'xyz', which</span><br/>               <span style="color: #A0A0A0">  48</span> <span style="color: #228B22; background: #FFFFFF;">%                                           traces in the x,y,z directions and combines</span><br/>               <span style="color: #A0A0A0">  49</span> <span style="color: #228B22; background: #FFFFFF;">%                                           the results.</span><br/>               <span style="color: #A0A0A0">  50</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  51</span> <span style="color: #228B22; background: #FFFFFF;">% OUTPUTS</span><br/>               <span style="color: #A0A0A0">  52</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  53</span> <span style="color: #228B22; background: #FFFFFF;">%     gridOUTPUT - Mandatory - PxQxR logical array - Voxelised data (1=&gt;Inside the mesh, 0=&gt;Outside the mesh)</span><br/>               <span style="color: #A0A0A0">  54</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  55</span> <span style="color: #228B22; background: #FFFFFF;">%     gridCOx    - Optional - 1xP array - List of the grid X coordinates.</span><br/>               <span style="color: #A0A0A0">  56</span> <span style="color: #228B22; background: #FFFFFF;">%     gridCOy    - Optional - 1xQ array - List of the grid Y coordinates.</span><br/>               <span style="color: #A0A0A0">  57</span> <span style="color: #228B22; background: #FFFFFF;">%     gridCOz    - Optional - 1xR array - List of the grid Z coordinates.</span><br/>               <span style="color: #A0A0A0">  58</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  59</span> <span style="color: #228B22; background: #FFFFFF;">% EXAMPLES</span><br/>               <span style="color: #A0A0A0">  60</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  61</span> <span style="color: #228B22; background: #FFFFFF;">%     To voxelise an STL file:</span><br/>               <span style="color: #A0A0A0">  62</span> <span style="color: #228B22; background: #FFFFFF;">%     &gt;&gt;  [gridOUTPUT] = VOXELISE(gridX,gridY,gridZ,STLin)</span><br/>               <span style="color: #A0A0A0">  63</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0">  64</span> <span style="color: #228B22; background: #FFFFFF;">%     To voxelise a mesh defined by a structure containing the faces and vertices:</span><br/>               <span style="color: #A0A0A0">  65</span> <span style="color: #228B22; background: #FFFFFF;">%     &gt;&gt;  [gridOUTPUT] = VOXELISE(gridX,gridY,gridZ,meshFV)</span><br/>               <span style="color: #A0A0A0">  66</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0">  67</span> <span style="color: #228B22; background: #FFFFFF;">%     To voxelise a mesh where the x,y,z coordinates are defined by three 3xN arrays:</span><br/>               <span style="color: #A0A0A0">  68</span> <span style="color: #228B22; background: #FFFFFF;">%     &gt;&gt;  [gridOUTPUT] = VOXELISE(gridX,gridY,gridZ,meshX,meshY,meshZ)</span><br/>               <span style="color: #A0A0A0">  69</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  70</span> <span style="color: #228B22; background: #FFFFFF;">%     To voxelise a mesh defined by a single Nx3x3 array:</span><br/>               <span style="color: #A0A0A0">  71</span> <span style="color: #228B22; background: #FFFFFF;">%     &gt;&gt;  [gridOUTPUT] = VOXELISE(gridX,gridY,gridZ,meshXYZ)</span><br/>               <span style="color: #A0A0A0">  72</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  73</span> <span style="color: #228B22; background: #FFFFFF;">%     To also output the lists of X,Y,Z coordinates:</span><br/>               <span style="color: #A0A0A0">  74</span> <span style="color: #228B22; background: #FFFFFF;">%     &gt;&gt;  [gridOUTPUT,gridCOx,gridCOy,gridCOz] = VOXELISE(gridX,gridY,gridZ,STLin)</span><br/>               <span style="color: #A0A0A0">  75</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  76</span> <span style="color: #228B22; background: #FFFFFF;">%     To use ray-tracing in only the z-direction:</span><br/>               <span style="color: #A0A0A0">  77</span> <span style="color: #228B22; background: #FFFFFF;">%     &gt;&gt;  [gridOUTPUT] = VOXELISE(gridX,gridY,gridZ,STLin,'z')</span><br/>               <span style="color: #A0A0A0">  78</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  79</span> <span style="color: #228B22; background: #FFFFFF;">% NOTES</span><br/>               <span style="color: #A0A0A0">  80</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  81</span> <span style="color: #228B22; background: #FFFFFF;">%   - The mesh must be properly closed (ie. watertight).</span><br/>               <span style="color: #A0A0A0">  82</span> <span style="color: #228B22; background: #FFFFFF;">%   - Defining raydirection='xyz' means that the mesh is ray-traced in each</span><br/>               <span style="color: #A0A0A0">  83</span> <span style="color: #228B22; background: #FFFFFF;">%     of the x,y,z directions, with the overall result being a combination</span><br/>               <span style="color: #A0A0A0">  84</span> <span style="color: #228B22; background: #FFFFFF;">%     of the result from each direction.  This gives the most reliable</span><br/>               <span style="color: #A0A0A0">  85</span> <span style="color: #228B22; background: #FFFFFF;">%     result at the expense of computation time.</span><br/>               <span style="color: #A0A0A0">  86</span> <span style="color: #228B22; background: #FFFFFF;">%   - Tracing in only one direction (eg. raydirection='z') is faster, but</span><br/>               <span style="color: #A0A0A0">  87</span> <span style="color: #228B22; background: #FFFFFF;">%     can potentially lead to artefacts where a ray exactly crosses</span><br/>               <span style="color: #A0A0A0">  88</span> <span style="color: #228B22; background: #FFFFFF;">%     several facet edges.</span><br/>               <span style="color: #A0A0A0">  89</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  90</span> <span style="color: #228B22; background: #FFFFFF;">% REFERENCES</span><br/>               <span style="color: #A0A0A0">  91</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  92</span> <span style="color: #228B22; background: #FFFFFF;">%   - This code uses a ray intersection method similar to that described by:</span><br/>               <span style="color: #A0A0A0">  93</span> <span style="color: #228B22; background: #FFFFFF;">%     Patil S and Ravi B.  Voxel-based representation, display and</span><br/>               <span style="color: #A0A0A0">  94</span> <span style="color: #228B22; background: #FFFFFF;">%     thickness analysis of intricate shapes. Ninth International</span><br/>               <span style="color: #A0A0A0">  95</span> <span style="color: #228B22; background: #FFFFFF;">%     Conference on Computer Aided Design and Computer Graphics (CAD/CG</span><br/>               <span style="color: #A0A0A0">  96</span> <span style="color: #228B22; background: #FFFFFF;">%     2005)</span><br/>               <span style="color: #A0A0A0">  97</span> <span style="color: #228B22; background: #FFFFFF;">%==========================================================================</span><br/>               <span style="color: #A0A0A0">  98</span> <span style="color: #228B22; background: #FFFFFF;">%==========================================================================</span><br/>               <span style="color: #A0A0A0">  99</span> <span style="color: #228B22; background: #FFFFFF;">% VERSION USER CHANGES</span><br/>               <span style="color: #A0A0A0"> 100</span> <span style="color: #228B22; background: #FFFFFF;">% ------- ---- -------</span><br/>               <span style="color: #A0A0A0"> 101</span> <span style="color: #228B22; background: #FFFFFF;">% 100510  AHA  Original version.</span><br/>               <span style="color: #A0A0A0"> 102</span> <span style="color: #228B22; background: #FFFFFF;">% 100514  AHA  Now works with non-STL input.  Changes also provide a</span><br/>               <span style="color: #A0A0A0"> 103</span> <span style="color: #228B22; background: #FFFFFF;">%              significant speed improvement.</span><br/>               <span style="color: #A0A0A0"> 104</span> <span style="color: #228B22; background: #FFFFFF;">% 100520  AHA  Now optionally output the grid x,y,z coordinates.</span><br/>               <span style="color: #A0A0A0"> 105</span> <span style="color: #228B22; background: #FFFFFF;">%              Robustness also improved.</span><br/>               <span style="color: #A0A0A0"> 106</span> <span style="color: #228B22; background: #FFFFFF;">% 100614  AHA  Define gridOUTPUT as a logical array to improve memory</span><br/>               <span style="color: #A0A0A0"> 107</span> <span style="color: #228B22; background: #FFFFFF;">%              efficiency.</span><br/>               <span style="color: #A0A0A0"> 108</span> <span style="color: #228B22; background: #FFFFFF;">% 100615  AHA  Reworked the ray interpolation code to correctly handle</span><br/>               <span style="color: #A0A0A0"> 109</span> <span style="color: #228B22; background: #FFFFFF;">%              logical arrays.</span><br/>               <span style="color: #A0A0A0"> 110</span> <span style="color: #228B22; background: #FFFFFF;">% 100623  AHA  Enable ray-tracing in any combination of the x,y,z</span><br/>               <span style="color: #A0A0A0"> 111</span> <span style="color: #228B22; background: #FFFFFF;">%              directions.</span><br/>               <span style="color: #A0A0A0"> 112</span> <span style="color: #228B22; background: #FFFFFF;">% 100628  AHA  Allow input to be a structure containing [faces,vertices]</span><br/>               <span style="color: #A0A0A0"> 113</span> <span style="color: #228B22; background: #FFFFFF;">%              data, similar to the type of structure output by</span><br/>               <span style="color: #A0A0A0"> 114</span> <span style="color: #228B22; background: #FFFFFF;">%              isosurface.</span><br/>               <span style="color: #A0A0A0"> 115</span> <span style="color: #228B22; background: #FFFFFF;">% 100907  AHA  Now allow the grid to be smaller than the mesh dimensions.</span><br/>               <span style="color: #A0A0A0"> 116</span> <span style="color: #228B22; background: #FFFFFF;">% 101126  AHA  Simplified code, slight speed improvement, more robust.</span><br/>               <span style="color: #A0A0A0"> 117</span> <span style="color: #228B22; background: #FFFFFF;">%              Changed handling of automatic grid generation to reduce</span><br/>               <span style="color: #A0A0A0"> 118</span> <span style="color: #228B22; background: #FFFFFF;">%              chance of artefacts.</span><br/>               <span style="color: #A0A0A0"> 119</span> <span style="color: #228B22; background: #FFFFFF;">% 101201  AHA  Fixed bug in automatic grid generation.</span><br/>               <span style="color: #A0A0A0"> 120</span> <span style="color: #228B22; background: #FFFFFF;">% 110303  AHA  Improved method of finding which mesh facets can possibly</span><br/>               <span style="color: #A0A0A0"> 121</span> <span style="color: #228B22; background: #FFFFFF;">%              be crossed by each ray.  Up to 80% reduction in run-time.</span><br/>               <span style="color: #A0A0A0"> 122</span> <span style="color: #228B22; background: #FFFFFF;">% 111104  AHA  Housekeeping tidy-up.</span><br/>               <span style="color: #A0A0A0"> 123</span> <span style="color: #228B22; background: #FFFFFF;">% 130212  AHA  Added checking of ray/vertex intersections, which reduces</span><br/>               <span style="color: #A0A0A0"> 124</span> <span style="color: #228B22; background: #FFFFFF;">%              artefacts in situations where the mesh vertices are located</span><br/>               <span style="color: #A0A0A0"> 125</span> <span style="color: #228B22; background: #FFFFFF;">%              directly on ray paths in the voxelisation grid.</span><br/>               <span style="color: #A0A0A0"> 126</span> <span style="color: #228B22; background: #FFFFFF;">%==========================================================================</span><br/>               <span style="color: #A0A0A0"> 127</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>               <span style="color: #A0A0A0"> 128</span> <span style="color: #228B22; background: #FFFFFF;">% CHECK THE REQUIRED NUMBER OF OUTPUT PARAMETERS</span><br/>               <span style="color: #A0A0A0"> 129</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 130</span> <span style="color: #000000; background: #FFFFFF;">  if ((nargout ~= 1) &amp;&amp; (nargout ~= 4)) </span><br/>               <span style="color: #A0A0A0"> 131</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('Incorrect number of output arguments.')</span><br/>               <span style="color: #A0A0A0"> 132</span> <span style="color: #A0A0A0; background: #FFFFFF;">  end</span><br/>               <span style="color: #A0A0A0"> 133</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>               <span style="color: #A0A0A0"> 134</span> <span style="color: #228B22; background: #FFFFFF;">% READ INPUT PARAMETERS</span><br/>               <span style="color: #A0A0A0"> 135</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>               <span style="color: #A0A0A0"> 136</span> <span style="color: #228B22; background: #FFFFFF;">% Read the ray direction if defined by the user, and remove this from the</span><br/>               <span style="color: #A0A0A0"> 137</span> <span style="color: #228B22; background: #FFFFFF;">% list of input arguments.  This makes it to make it easier to extract the</span><br/>               <span style="color: #A0A0A0"> 138</span> <span style="color: #228B22; background: #FFFFFF;">% mesh data from the input arguments in the subsequent step.</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 139</span> <span style="color: #000000; background: #FFFFFF;">  if (ischar(varargin{end}) &amp;&amp; max(strcmpi(varargin{end}, {'x', 'y', 'z', 'xy', 'xz', 'yx', 'yz', 'zx', 'zy', 'xyz', 'xzy', 'yxz', 'yzx', 'zxy', 'zyx'}))) </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 140</span> <span style="color: #000000; background: #FFFFFF;">    raydirection = lower(varargin{end}); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 141</span> <span style="color: #000000; background: #FFFFFF;">    varargin = varargin((1 : (nargin - 4))); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 142</span> <span style="color: #000000; background: #FFFFFF;">    narginremaining = (nargin - 1); </span><br/>               <span style="color: #A0A0A0"> 143</span> <span style="color: #228B22; background: #FFFFFF;">  else </span><br/>               <span style="color: #A0A0A0"> 144</span> <span style="color: #A0A0A0; background: #FFFFFF;">    raydirection = 'xyz';  %Set the default value if none is defined by the user</span><br/>               <span style="color: #A0A0A0"> 145</span> <span style="color: #A0A0A0; background: #FFFFFF;">    narginremaining = nargin;</span><br/>               <span style="color: #A0A0A0"> 146</span> <span style="color: #A0A0A0; background: #FFFFFF;">  end</span><br/>               <span style="color: #A0A0A0"> 147</span> <span style="color: #228B22; background: #FFFFFF;">% Whatever the input mesh format is, it is converted to an Nx3x3 array</span><br/>               <span style="color: #A0A0A0"> 148</span> <span style="color: #228B22; background: #FFFFFF;">% defining the vertex positions for each facet, with 1 row for each facet,</span><br/>               <span style="color: #A0A0A0"> 149</span> <span style="color: #228B22; background: #FFFFFF;">% 3 cols for the x,y,z coordinates, and 3 pages for the three vertices.</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 150</span> <span style="color: #000000; background: #FFFFFF;">  if (narginremaining == 4) </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 151</span> <span style="color: #000000; background: #FFFFFF;">    if (isstruct(varargin{1}) == 1) </span><br/>               <span style="color: #A0A0A0"> 152</span> <span style="color: #A0A0A0; background: #FFFFFF;">      meshXYZ = CONVERT_meshformat(varargin{1}.faces, varargin{1}.vertices);</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 153</span> <span style="color: #000000; background: #FFFFFF;">    elseif ischar(varargin{1}) </span><br/>               <span style="color: #A0A0A0"> 154</span> <span style="color: #A0A0A0; background: #FFFFFF;">      meshXYZ = READ_stl(varargin{1});</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 155</span> <span style="color: #228B22; background: #FFFFFF;">    else  </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 156</span> <span style="color: #000000; background: #FFFFFF;">      meshXYZ = varargin{1}; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 157</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 158</span> <span style="color: #A0A0A0; background: #FFFFFF;">  elseif (narginremaining == 6)</span><br/>               <span style="color: #A0A0A0"> 159</span> <span style="color: #A0A0A0; background: #FFFFFF;">    meshX = varargin{1};</span><br/>               <span style="color: #A0A0A0"> 160</span> <span style="color: #A0A0A0; background: #FFFFFF;">    meshY = varargin{2};</span><br/>               <span style="color: #A0A0A0"> 161</span> <span style="color: #A0A0A0; background: #FFFFFF;">    meshZ = varargin{3};</span><br/>               <span style="color: #A0A0A0"> 162</span> <span style="color: #A0A0A0; background: #FFFFFF;">    meshXYZ = zeros(size(meshX, 2), 3, size(meshX, 1));</span><br/>               <span style="color: #A0A0A0"> 163</span> <span style="color: #A0A0A0; background: #FFFFFF;">    meshXYZ(:, 1, :) = reshape((meshX'), size(meshX, 2), 1, 3);</span><br/>               <span style="color: #A0A0A0"> 164</span> <span style="color: #A0A0A0; background: #FFFFFF;">    meshXYZ(:, 2, :) = reshape((meshY'), size(meshY, 2), 1, 3);</span><br/>               <span style="color: #A0A0A0"> 165</span> <span style="color: #A0A0A0; background: #FFFFFF;">    meshXYZ(:, 3, :) = reshape((meshZ'), size(meshZ, 2), 1, 3);</span><br/>               <span style="color: #A0A0A0"> 166</span> <span style="color: #228B22; background: #FFFFFF;">  else </span><br/>               <span style="color: #A0A0A0"> 167</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('Incorrect number of input arguments.')</span><br/>               <span style="color: #A0A0A0"> 168</span> <span style="color: #A0A0A0; background: #FFFFFF;">  end</span><br/>               <span style="color: #A0A0A0"> 169</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>               <span style="color: #A0A0A0"> 170</span> <span style="color: #228B22; background: #FFFFFF;">% IDENTIFY THE MIN AND MAX X,Y,Z COORDINATES OF THE POLYGON MESH</span><br/>               <span style="color: #A0A0A0"> 171</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 172</span> <span style="color: #000000; background: #FFFFFF;">  meshXmin = min(min(meshXYZ(:, 1, :))); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 173</span> <span style="color: #000000; background: #FFFFFF;">  meshXmax = max(max(meshXYZ(:, 1, :))); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 174</span> <span style="color: #000000; background: #FFFFFF;">  meshYmin = min(min(meshXYZ(:, 2, :))); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 175</span> <span style="color: #000000; background: #FFFFFF;">  meshYmax = max(max(meshXYZ(:, 2, :))); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 176</span> <span style="color: #000000; background: #FFFFFF;">  meshZmin = min(min(meshXYZ(:, 3, :))); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 177</span> <span style="color: #000000; background: #FFFFFF;">  meshZmax = max(max(meshXYZ(:, 3, :))); </span><br/>               <span style="color: #A0A0A0"> 178</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>               <span style="color: #A0A0A0"> 179</span> <span style="color: #228B22; background: #FFFFFF;">% CHECK THE DIMENSIONS OF THE 3D OUTPUT GRID</span><br/>               <span style="color: #A0A0A0"> 180</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>               <span style="color: #A0A0A0"> 181</span> <span style="color: #228B22; background: #FFFFFF;">% The output grid will be defined by the coordinates in gridCOx, gridCOy, gridCOz</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 182</span> <span style="color: #000000; background: #FFFFFF;">  if (numel(gridX) &gt; 1) </span><br/>               <span style="color: #A0A0A0"> 183</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if (size(gridX, 1) &gt; size(gridX, 2))</span><br/>               <span style="color: #A0A0A0"> 184</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOx = (gridX');  %gridX should be a row vector rather than a column vector</span><br/>               <span style="color: #A0A0A0"> 185</span> <span style="color: #228B22; background: #FFFFFF;">    else </span><br/>               <span style="color: #A0A0A0"> 186</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOx = gridX;</span><br/>               <span style="color: #A0A0A0"> 187</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 188</span> <span style="color: #000000; background: #FFFFFF;">  elseif ((numel(gridX) == 1) &amp;&amp; (gridX == 1)) </span><br/>               <span style="color: #A0A0A0"> 189</span> <span style="color: #A0A0A0; background: #FFFFFF;">    gridCOx = ((meshXmin + meshXmax) / 2);  %If gridX is a single integer (rather than a vector) and is equal to 1</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 190</span> <span style="color: #000000; background: #FFFFFF;">  elseif ((numel(gridX) == 1) &amp;&amp; (rem(gridX, 1) == 0)) </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 191</span> <span style="color: #000000; background: #FFFFFF;">    voxwidth = ((meshXmax - meshXmin) / (gridX + (1 / 2)));  %If gridX is a single integer (rather than a vector) then automatically create the list of x coordinates </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 192</span> <span style="color: #000000; background: #FFFFFF;">    gridCOx = ((meshXmin + (voxwidth / 2)) : voxwidth : (meshXmax - (voxwidth / 2))); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 193</span> <span style="color: #000000; background: #FFFFFF;">  end </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 194</span> <span style="color: #000000; background: #FFFFFF;">  if (numel(gridY) &gt; 1) </span><br/>               <span style="color: #A0A0A0"> 195</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if (size(gridY, 1) &gt; size(gridY, 2))</span><br/>               <span style="color: #A0A0A0"> 196</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOy = (gridY');  %gridY should be a row vector rather than a column vector</span><br/>               <span style="color: #A0A0A0"> 197</span> <span style="color: #228B22; background: #FFFFFF;">    else </span><br/>               <span style="color: #A0A0A0"> 198</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOy = gridY;</span><br/>               <span style="color: #A0A0A0"> 199</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 200</span> <span style="color: #000000; background: #FFFFFF;">  elseif ((numel(gridY) == 1) &amp;&amp; (gridY == 1)) </span><br/>               <span style="color: #A0A0A0"> 201</span> <span style="color: #A0A0A0; background: #FFFFFF;">    gridCOy = ((meshYmin + meshYmax) / 2);  %If gridX is a single integer (rather than a vector) and is equal to 1</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 202</span> <span style="color: #000000; background: #FFFFFF;">  elseif ((numel(gridY) == 1) &amp;&amp; (rem(gridY, 1) == 0)) </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 203</span> <span style="color: #000000; background: #FFFFFF;">    voxwidth = ((meshYmax - meshYmin) / (gridY + (1 / 2)));  %If gridX is a single integer (rather than a vector) then automatically create the list of y coordinates </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 204</span> <span style="color: #000000; background: #FFFFFF;">    gridCOy = ((meshYmin + (voxwidth / 2)) : voxwidth : (meshYmax - (voxwidth / 2))); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 205</span> <span style="color: #000000; background: #FFFFFF;">  end </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 206</span> <span style="color: #000000; background: #FFFFFF;">  if (numel(gridZ) &gt; 1) </span><br/>               <span style="color: #A0A0A0"> 207</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if (size(gridZ, 1) &gt; size(gridZ, 2))</span><br/>               <span style="color: #A0A0A0"> 208</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOz = (gridZ');  %gridZ should be a row vector rather than a column vector</span><br/>               <span style="color: #A0A0A0"> 209</span> <span style="color: #228B22; background: #FFFFFF;">    else </span><br/>               <span style="color: #A0A0A0"> 210</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOz = gridZ;</span><br/>               <span style="color: #A0A0A0"> 211</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 212</span> <span style="color: #000000; background: #FFFFFF;">  elseif ((numel(gridZ) == 1) &amp;&amp; (gridZ == 1)) </span><br/>               <span style="color: #A0A0A0"> 213</span> <span style="color: #A0A0A0; background: #FFFFFF;">    gridCOz = ((meshZmin + meshZmax) / 2);  %If gridX is a single integer (rather than a vector) and is equal to 1</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 214</span> <span style="color: #000000; background: #FFFFFF;">  elseif ((numel(gridZ) == 1) &amp;&amp; (rem(gridZ, 1) == 0)) </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 215</span> <span style="color: #000000; background: #FFFFFF;">    voxwidth = ((meshZmax - meshZmin) / (gridZ + (1 / 2)));  %If gridZ is a single integer (rather than a vector) then automatically create the list of z coordinates </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 216</span> <span style="color: #000000; background: #FFFFFF;">    gridCOz = ((meshZmin + (voxwidth / 2)) : voxwidth : (meshZmax - (voxwidth / 2))); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 217</span> <span style="color: #000000; background: #FFFFFF;">  end </span><br/>               <span style="color: #A0A0A0"> 218</span> <span style="color: #228B22; background: #FFFFFF;">%Check that the output grid is large enough to cover the mesh:</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 219</span> <span style="color: #000000; background: #FFFFFF;">  if ((~isempty(strfind(raydirection, 'x'))) &amp;&amp; ((min(gridCOx) &gt; meshXmin) || (max(gridCOx) &lt; meshXmax))) </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 220</span> <span style="color: #000000; background: #FFFFFF;">    gridcheckX = 0; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 221</span> <span style="color: #000000; background: #FFFFFF;">    if (min(gridCOx) &gt; meshXmin) </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 222</span> <span style="color: #000000; background: #FFFFFF;">      gridCOx = [meshXmin, gridCOx]; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 223</span> <span style="color: #000000; background: #FFFFFF;">      gridcheckX = (gridcheckX + 1); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 224</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 225</span> <span style="color: #000000; background: #FFFFFF;">    if (max(gridCOx) &lt; meshXmax) </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 226</span> <span style="color: #000000; background: #FFFFFF;">      gridCOx = [gridCOx, meshXmax]; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 227</span> <span style="color: #000000; background: #FFFFFF;">      gridcheckX = (gridcheckX + 2); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 228</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 229</span> <span style="color: #A0A0A0; background: #FFFFFF;">  elseif ((~isempty(strfind(raydirection, 'y'))) &amp;&amp; ((min(gridCOy) &gt; meshYmin) || (max(gridCOy) &lt; meshYmax)))</span><br/>               <span style="color: #A0A0A0"> 230</span> <span style="color: #A0A0A0; background: #FFFFFF;">    gridcheckY = 0;</span><br/>               <span style="color: #A0A0A0"> 231</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if (min(gridCOy) &gt; meshYmin)</span><br/>               <span style="color: #A0A0A0"> 232</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOy = [meshYmin, gridCOy];</span><br/>               <span style="color: #A0A0A0"> 233</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridcheckY = (gridcheckY + 1);</span><br/>               <span style="color: #A0A0A0"> 234</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 235</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if (max(gridCOy) &lt; meshYmax)</span><br/>               <span style="color: #A0A0A0"> 236</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOy = [gridCOy, meshYmax];</span><br/>               <span style="color: #A0A0A0"> 237</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridcheckY = (gridcheckY + 2);</span><br/>               <span style="color: #A0A0A0"> 238</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 239</span> <span style="color: #A0A0A0; background: #FFFFFF;">  elseif ((~isempty(strfind(raydirection, 'z'))) &amp;&amp; ((min(gridCOz) &gt; meshZmin) || (max(gridCOz) &lt; meshZmax)))</span><br/>               <span style="color: #A0A0A0"> 240</span> <span style="color: #A0A0A0; background: #FFFFFF;">    gridcheckZ = 0;</span><br/>               <span style="color: #A0A0A0"> 241</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if (min(gridCOz) &gt; meshZmin)</span><br/>               <span style="color: #A0A0A0"> 242</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOz = [meshZmin, gridCOz];</span><br/>               <span style="color: #A0A0A0"> 243</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridcheckZ = (gridcheckZ + 1);</span><br/>               <span style="color: #A0A0A0"> 244</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 245</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if (max(gridCOz) &lt; meshZmax)</span><br/>               <span style="color: #A0A0A0"> 246</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOz = [gridCOz, meshZmax];</span><br/>               <span style="color: #A0A0A0"> 247</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridcheckZ = (gridcheckZ + 2);</span><br/>               <span style="color: #A0A0A0"> 248</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 249</span> <span style="color: #A0A0A0; background: #FFFFFF;">  end</span><br/>               <span style="color: #A0A0A0"> 250</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>               <span style="color: #A0A0A0"> 251</span> <span style="color: #228B22; background: #FFFFFF;">% VOXELISE USING THE USER DEFINED RAY DIRECTION(S)</span><br/>               <span style="color: #A0A0A0"> 252</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>               <span style="color: #A0A0A0"> 253</span> <span style="color: #228B22; background: #FFFFFF;">%Count the number of voxels in each direction:</span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 254</span> <a name="Line254"></a><span style="color: #000000; background: #FFFFFF;">  voxcountX = numel(gridCOx); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 255</span> <span style="color: #000000; background: #FFFFFF;">  voxcountY = numel(gridCOy); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 256</span> <span style="color: #000000; background: #FFFFFF;">  voxcountZ = numel(gridCOz); </span><br/>               <span style="color: #A0A0A0"> 257</span> <span style="color: #228B22; background: #FFFFFF;">% Prepare logical array to hold the voxelised data:</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 258</span> <span style="color: #000000; background: #FFFFFF;">  gridOUTPUT = false(voxcountX, voxcountY, voxcountZ, numel(raydirection)); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 259</span> <span style="color: #000000; background: #FFFFFF;">  countdirections = 0; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 260</span> <span style="color: #000000; background: #FFFFFF;">  if strfind(raydirection, 'x') </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 261</span> <span style="color: #000000; background: #FFFFFF;">    countdirections = (countdirections + 1); </span><br/><span style="color: #FF0000"> 32.84 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 262</span> <a name="Line262"></a><span style="color: #000000; background: #FF8080;">    gridOUTPUT(:, :, :, countdirections) = permute(<a href="file5.html">VOXELISEinternal</a>(gridCOy, gridCOz, gridCOx, meshXYZ(:, [2, 3, 1], :)), [3, 1, 2]); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 263</span> <span style="color: #000000; background: #FFFFFF;">  end </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 264</span> <span style="color: #000000; background: #FFFFFF;">  if strfind(raydirection, 'y') </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 265</span> <span style="color: #000000; background: #FFFFFF;">    countdirections = (countdirections + 1); </span><br/><span style="color: #FF0000">  9.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 266</span> <a name="Line266"></a><span style="color: #000000; background: #FFE2E2;">    gridOUTPUT(:, :, :, countdirections) = permute(<a href="file5.html">VOXELISEinternal</a>(gridCOz, gridCOx, gridCOy, meshXYZ(:, [3, 1, 2], :)), [2, 3, 1]); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 267</span> <span style="color: #000000; background: #FFFFFF;">  end </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 268</span> <span style="color: #000000; background: #FFFFFF;">  if strfind(raydirection, 'z') </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 269</span> <span style="color: #000000; background: #FFFFFF;">    countdirections = (countdirections + 1); </span><br/><span style="color: #FF0000">  9.53 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 270</span> <a name="Line270"></a><span style="color: #000000; background: #FFE2E2;">    gridOUTPUT(:, :, :, countdirections) = <a href="file5.html">VOXELISEinternal</a>(gridCOx, gridCOy, gridCOz, meshXYZ); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 271</span> <span style="color: #000000; background: #FFFFFF;">  end </span><br/>               <span style="color: #A0A0A0"> 272</span> <span style="color: #228B22; background: #FFFFFF;">% Combine the results of each ray-tracing direction:</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 273</span> <span style="color: #000000; background: #FFFFFF;">  if (numel(raydirection) &gt; 1) </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 274</span> <span style="color: #000000; background: #FFFFFF;">    gridOUTPUT = (sum(gridOUTPUT, 4) &gt;= (numel(raydirection) / 2)); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 275</span> <span style="color: #000000; background: #FFFFFF;">  end </span><br/>               <span style="color: #A0A0A0"> 276</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>               <span style="color: #A0A0A0"> 277</span> <span style="color: #228B22; background: #FFFFFF;">% RETURN THE OUTPUT GRID TO THE SIZE REQUIRED BY THE USER (IF IT WAS CHANGED EARLIER)</span><br/>               <span style="color: #A0A0A0"> 278</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 279</span> <span style="color: #000000; background: #FFFFFF;">  if exist('gridcheckX', 'var') </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 280</span> <span style="color: #000000; background: #FFFFFF;">    if (gridcheckX == 1) </span><br/>               <span style="color: #A0A0A0"> 281</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridOUTPUT = gridOUTPUT((2 : end), :, :);</span><br/>               <span style="color: #A0A0A0"> 282</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOx = gridCOx((2 : end));</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 283</span> <span style="color: #000000; background: #FFFFFF;">    elseif (gridcheckX == 2) </span><br/>               <span style="color: #A0A0A0"> 284</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridOUTPUT = gridOUTPUT((1 : (end - 1)), :, :);</span><br/>               <span style="color: #A0A0A0"> 285</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOx = gridCOx((1 : (end - 1)));</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 286</span> <span style="color: #000000; background: #FFFFFF;">    elseif (gridcheckX == 3) </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 287</span> <span style="color: #000000; background: #FFFFFF;">      gridOUTPUT = gridOUTPUT((2 : (end - 1)), :, :); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 288</span> <span style="color: #000000; background: #FFFFFF;">      gridCOx = gridCOx((2 : (end - 1))); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 289</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 290</span> <span style="color: #000000; background: #FFFFFF;">  end </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 291</span> <span style="color: #000000; background: #FFFFFF;">  if exist('gridcheckY', 'var') </span><br/>               <span style="color: #A0A0A0"> 292</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if (gridcheckY == 1)</span><br/>               <span style="color: #A0A0A0"> 293</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridOUTPUT = gridOUTPUT(:, (2 : end), :);</span><br/>               <span style="color: #A0A0A0"> 294</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOy = gridCOy((2 : end));</span><br/>               <span style="color: #A0A0A0"> 295</span> <span style="color: #A0A0A0; background: #FFFFFF;">    elseif (gridcheckY == 2)</span><br/>               <span style="color: #A0A0A0"> 296</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridOUTPUT = gridOUTPUT(:, (1 : (end - 1)), :);</span><br/>               <span style="color: #A0A0A0"> 297</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOy = gridCOy((1 : (end - 1)));</span><br/>               <span style="color: #A0A0A0"> 298</span> <span style="color: #A0A0A0; background: #FFFFFF;">    elseif (gridcheckY == 3)</span><br/>               <span style="color: #A0A0A0"> 299</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridOUTPUT = gridOUTPUT(:, (2 : (end - 1)), :);</span><br/>               <span style="color: #A0A0A0"> 300</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOy = gridCOy((2 : (end - 1)));</span><br/>               <span style="color: #A0A0A0"> 301</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 302</span> <span style="color: #A0A0A0; background: #FFFFFF;">  end</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 303</span> <span style="color: #000000; background: #FFFFFF;">  if exist('gridcheckZ', 'var') </span><br/>               <span style="color: #A0A0A0"> 304</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if (gridcheckZ == 1)</span><br/>               <span style="color: #A0A0A0"> 305</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridOUTPUT = gridOUTPUT(:, :, (2 : end));</span><br/>               <span style="color: #A0A0A0"> 306</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOz = gridCOz((2 : end));</span><br/>               <span style="color: #A0A0A0"> 307</span> <span style="color: #A0A0A0; background: #FFFFFF;">    elseif (gridcheckZ == 2)</span><br/>               <span style="color: #A0A0A0"> 308</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridOUTPUT = gridOUTPUT(:, :, (1 : (end - 1)));</span><br/>               <span style="color: #A0A0A0"> 309</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOz = gridCOz((1 : (end - 1)));</span><br/>               <span style="color: #A0A0A0"> 310</span> <span style="color: #A0A0A0; background: #FFFFFF;">    elseif (gridcheckZ == 3)</span><br/>               <span style="color: #A0A0A0"> 311</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridOUTPUT = gridOUTPUT(:, :, (2 : (end - 1)));</span><br/>               <span style="color: #A0A0A0"> 312</span> <span style="color: #A0A0A0; background: #FFFFFF;">      gridCOz = gridCOz((2 : (end - 1)));</span><br/>               <span style="color: #A0A0A0"> 313</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 314</span> <span style="color: #A0A0A0; background: #FFFFFF;">  end</span><br/>               <span style="color: #A0A0A0"> 315</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>               <span style="color: #A0A0A0"> 316</span> <span style="color: #228B22; background: #FFFFFF;">% PREPARE THE OUTPUT PARAMETERS</span><br/>               <span style="color: #A0A0A0"> 317</span> <span style="color: #228B22; background: #FFFFFF;">%======================================================</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 318</span> <span style="color: #000000; background: #FFFFFF;">  if (nargout == 4) </span><br/>               <span style="color: #A0A0A0"> 319</span> <span style="color: #A0A0A0; background: #FFFFFF;">    varargout(1) = {gridCOx};</span><br/>               <span style="color: #A0A0A0"> 320</span> <span style="color: #A0A0A0; background: #FFFFFF;">    varargout(2) = {gridCOy};</span><br/>               <span style="color: #A0A0A0"> 321</span> <span style="color: #A0A0A0; background: #FFFFFF;">    varargout(3) = {gridCOz};</span><br/>               <span style="color: #A0A0A0"> 322</span> <span style="color: #A0A0A0; background: #FFFFFF;">  end</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 323</span> <span style="color: #000000; background: #FFFFFF;">  if AM_EntryPoint_1 </span><br/>               <span style="color: #A0A0A0"> 324</span> <span style="color: #A0A0A0; background: #FFFFFF;">    AM_GLOBAL = [];</span><br/>               <span style="color: #A0A0A0"> 325</span> <span style="color: #A0A0A0; background: #FFFFFF;">  end</span><br/>               <span style="color: #A0A0A0"> 326</span> <span style="color: #228B22; background: #FFFFFF;">%function</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 327</span> <a name="Line327"></a><span style="color: #000000; background: #FFFFFF;">end </span><br/></pre><p><p>Other subfunctions in this file are not included in this listing.</body></html>